From 72b3a820214fc50d50b8ac0f031491106d8d8634 Mon Sep 17 00:00:00 2001
From: Lars Wendler <polynomial-c@gentoo.org>
Date: Mon, 18 Jan 2021 14:01:54 +0100
Subject: [PATCH] net/pppd.sh: Completely overhauled pppd version check

Thanks-to: Kerin Millar <kfm@plushkava.net>
Bug: https://bugs.gentoo.org/729920

Signed-off-by: Lars Wendler <polynomial-c@gentoo.org>
---
 net/pppd.sh | 24 +++---------------------
 1 file changed, 3 insertions(+), 21 deletions(-)

diff --git a/net/pppd.sh b/net/pppd.sh
index 2182497..22644f2 100644
--- a/net/pppd.sh
+++ b/net/pppd.sh
@@ -23,28 +23,10 @@ requote()
 
 pppd_is_ge_248()
 {
-	local ver_str="$(/usr/sbin/pppd --version 2>&1 | awk '/pppd version/ {print $3}')"
-	local maj_ver="$(echo ${ver_str} | cut -d . -f 1)"
-	local min_ver="$(echo ${ver_str} | cut -d . -f 2)"
-	local patch_ver="$(echo ${ver_str} | cut -d . -f 3)"
+	local ver_str="$(/usr/sbin/pppd --version 2>&1 | awk '/pppd version/ {print $3}' | tr '.' ' ')"
 
-	if [ "${maj_ver}" -gt 2 ] ; then
-		return 0
-	elif [ "${maj_ver}" -eq 2 ] ; then
-		if [ "${min_ver}" -gt 4 ] ; then
-			return 0
-		elif [ "${min_ver}" -eq 4 ] ; then
-			if [ "${patch_ver}" -ge 8 ] ; then
-				return 0
-			else
-				return 1
-			fi
-		else
-			return 1
-		fi
-	else
-		return 1
-	fi
+	# 002004008 is v2.4.8
+	[ "$(printf '%03d' ${ver_str})" -ge 002004008 ]
 }
 
 pppd_pre_start()
-- 
2.30.0

