--- a/modules/hw/vdpau/Makefile.am
+++ b/modules/hw/vdpau/Makefile.am
@@ -45,6 +45,7 @@
 libvdpau_chroma_plugin_la_LIBADD = libvlc_vdpau.la
 vdpau_LTLIBRARIES += libvdpau_chroma_plugin.la
 
+if HAVE_XCB
 libvdpau_display_plugin_la_SOURCES = display.c
 libvdpau_display_plugin_la_CPPFLAGS = $(AM_CPPFLAGS) -I$(srcdir)/../../video_output/xcb
 libvdpau_display_plugin_la_CFLAGS = $(AM_CFLAGS) $(XCB_CFLAGS)
@@ -52,3 +53,4 @@
 	../../video_output/libvlc_xcb_events.la \
 	$(AM_LIBADD) $(X_LIBS) $(X_PRE_LIBS) -lX11 $(XCB_LIBS)
 vdpau_LTLIBRARIES += libvdpau_display_plugin.la
+endif
